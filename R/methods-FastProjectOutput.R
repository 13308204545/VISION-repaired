#' Wrapper for the output from a FastProject object. Generated by calling Analyze on a defined
#' FastProject object.

library(jug)
library(jsonlite)

#' Initialize a new FastProjectOuptput object
#'
#' @param eData ExpressionData matrix
#' @param filterModuleList List of FilterModuleData objects
#' @param sigMatirx Matrix of signature scores (NUM_SIGS x NUM_CELLS)
#' @param sigList List of Signatures
#' @param fpParams List of the FastProject parameters that were used to generate this object
#' @return FastProjectOutput object.
setMethod("initialize", signature(.Object="FastProjectOutput"),
          function(.Object, eData, filterModuleList, sigMatrix, sigList, fpParams, pools) {

            .Object@exprData <- eData
            .Object@filterModuleList <- filterModuleList
            .Object@sigMatrix <- sigMatrix
            .Object@sigList <- sigList
            .Object@fpParams <- fpParams
            .Object@pools <- pools

            return(.Object)
          }
)

#' Save the FastProjectOutput object as an .RDS file and view the results on a localhost
#'
#' @param fpout FastProjectOutput object
#' @return None
#' @export
#' @examples
#' fpout <- Analyze(fp)
#' saveFPOutAndViewResults(fpout)
setMethod("saveFPOutAndViewResults", signature(fpout="FastProjectOutput"),
          function(fpout) {
            #' Generate an HTML Output Report from a FastProjectOutput Object by first saving the object
            #' Includes a server script for getting json data from FastProjectOutput
            #'
            #' Parameters:
            #'  object: FastProjectOutput object
            #'    Data object obtained from running Analyze() on a FastProject object
            #'  url: character
            #'    URL to generate output report at

            i <- 1
            ofile <- paste0("FastProject_Output/fpout", i, ".rds")
            while (file.exists(ofile)) {
              i <- i+1
              ofile <- paste0("FastProject_Output/fpout", i, ".rds")
            }

            saveRDS(fpout, file=ofile)
            arg1 <<- ofile

            message("Launching the server...")
            message("Press exit or ctrl c to exit")
            source("FastProject_Output/server_script.R")
          })

#' View results of analysis without saving output object
#'
#' @param fpout FastProjectOutput object
#' @return None.
#' @export
#' @examples
#' fpout <- Analyze(fp)
#' viewResults(fpout)
setMethod("viewResults", signature(object="FastProjectOutput"),
          function(object) {

            arg1 <<- object
            message("Launching the server...")
            message("Press exit or ctrl c to exit")
            source("FastProject_Output/server_script.R")
          })
