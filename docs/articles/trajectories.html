<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trajectory Inference and VISION • VISION</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Trajectory Inference and VISION">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">VISION</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.99.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/VISION-vignette.html">Introduction to VISION</a>
    </li>
    <li>
      <a href="../articles/micropooling.html">Micropooling and VISION</a>
    </li>
    <li>
      <a href="../articles/trajectories.html">Trajectory Inference and VISION</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Trajectory Inference and VISION</h1>
                        <h4 class="author">Matthew Jones</h4>
            
            <h4 class="date">7 November 2018</h4>
      
      
      <div class="hidden name"><code>trajectories.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>VISION can be used as a downstream tool for analyzing the biological significance of trajectories. The tool interfaces with the objects output from <a href="https://github.com/dynverse">Dynverse</a>. Briefly, Dynverse objects are general wrappers for any trajectory method, and VISION specifically depends on two components in particular:</p>
<ul>
<li>The milestone network (essentially the topology of the trajectory produced from your favorite trajectory method)</li>
<li>The progression of cells along each edge in the milestone network. We expect that each cell is only present on a single edge.</li>
</ul>
<p>This amounts to a latent space, which describes relationships between cells, and can be used for calculating signature consistency scores in the default pipeline.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You should have a working installation of <a href="https://github.com/YosefLab/VISION">VISION</a>, <a href="https://github.com/dynverse/dyno">dyno</a>, and <a href="https://github.com/tidyverse/tidyverse">tidyverse</a>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"YosefLab/VISION"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"dynverse/dyno"</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">install.packages</span>(<span class="st">'tidyverse'</span>)</a></code></pre></div>
</div>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>In this vignette, we’ll be analyzing a set of ~5,000 cells during haematopoiesis (<a href="https://www.nature.com/articles/nature25741">Tusi et al, Nature 2018</a>).</p>
</div>
</div>
<div id="workflow" class="section level1">
<h1 class="hasAnchor">
<a href="#workflow" class="anchor"></a>Workflow</h1>
<p>We begin by loading in the data and requisite libraries:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(VISION)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">library</span>(dyno)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">counts =<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">read.table</span>(<span class="st">"data/hemato_counts.csv.gz"</span>, <span class="dt">sep=</span><span class="st">','</span>, <span class="dt">header=</span>T, <span class="dt">row.names=</span><span class="dv">1</span>))</a></code></pre></div>
<p>We’ll now follow the <a href="https://github.com/dynverse/dyno">dyno vignette</a> in the github README. You’ll need to make sure you have <a href="https://docs.docker.com/install/">Docker</a> installed. Although we use Monocle2 here, there is a wide variety of methods that can be used, as listed on the <a href="https://github.com/dynverse/dynmethods">Dynmethods page</a>.</p>
<p>Before running the model, we’ll need to perform some gene filtering. We first only select the genes used in the original Tusi et al study, then for further efficiency, we further filter using VISION’s Fano filtering.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">k.genes =<span class="st"> </span><span class="kw">read.table</span>(<span class="st">"data/bBM.filtered_gene_list.paper.txt.gz"</span>, <span class="dt">sep=</span><span class="st">','</span>)[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">filt.counts =<span class="st"> </span>counts[k.genes,]</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">f.genes =<span class="st"> </span>VISION<span class="op">:::</span><span class="kw"><a href="../reference/filterGenesFano.html">filterGenesFano</a></span>(filt.counts)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">filt.counts =<span class="st"> </span>filt.counts[f.genes,]</a></code></pre></div>
<p>Now, resuming the workflow recommended on the dyno vignette,</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">scale.factor =<span class="st"> </span><span class="kw">median</span>(<span class="kw">colSums</span>(counts))</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">expr =<span class="st"> </span><span class="kw">apply</span>(counts, <span class="dv">2</span>, <span class="cf">function</span>(x) (x <span class="op">*</span><span class="st"> </span>scale.factor) <span class="op">/</span><span class="st"> </span>(<span class="kw">sum</span>(x) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">filt.expr =<span class="st"> </span><span class="kw">log</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>expr[f.genes,])</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">dataset =<span class="st"> </span><span class="kw">wrap_expression</span>(</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">  <span class="dt">counts =</span> <span class="kw">t</span>(filt.counts),</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">  <span class="dt">expression =</span> <span class="kw">t</span>(filt.expr)</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb5-9" data-line-number="9"></a>
<a class="sourceLine" id="cb5-10" data-line-number="10">model &lt;-<span class="st"> </span><span class="kw">infer_trajectory</span>(dataset, <span class="st">"projected_slingshot"</span>, <span class="dt">verbose=</span>T)</a>
<a class="sourceLine" id="cb5-11" data-line-number="11"></a>
<a class="sourceLine" id="cb5-12" data-line-number="12">model &lt;-<span class="st"> </span>model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">add_dimred</span>(dyndimred<span class="op">::</span>dimred_mds, <span class="dt">expression_source =</span> dataset<span class="op">$</span>expression)</a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="kw">plot_dimred</span>(</a>
<a class="sourceLine" id="cb5-14" data-line-number="14">  model, </a>
<a class="sourceLine" id="cb5-15" data-line-number="15">  <span class="dt">expression_source =</span> dataset<span class="op">$</span>expression</a>
<a class="sourceLine" id="cb5-16" data-line-number="16">)</a></code></pre></div>
<p>Now, with this model saved we can pass it to VISION via the <code>latentTrajectory</code> parameter. The model will automatically be analzyed with the same signatures passed to the FastProjectR object, and with this model, the <code>Trajectory</code> tab will be activated in the VISION output report.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">covar =<span class="st"> </span><span class="kw">read.table</span>(<span class="st">"data/hemato_covariates.txt.gz"</span>, <span class="dt">sep=</span><span class="st">'</span><span class="ch">\t</span><span class="st">'</span>, <span class="dt">header=</span>T, <span class="dt">row.names=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">covar =<span class="st"> </span>covar[<span class="kw">colnames</span>(expr), <span class="dv">-1</span>]</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">vis &lt;-<span class="st"> </span><span class="kw"><a href="../reference/VISION-class.html">Vision</a></span>(expr, </a>
<a class="sourceLine" id="cb6-4" data-line-number="4">            <span class="kw">c</span>(<span class="st">"data/h.all.v5.2.symbols.gmt"</span>), </a>
<a class="sourceLine" id="cb6-5" data-line-number="5">            <span class="dt">projection_genes =</span> f.genes, </a>
<a class="sourceLine" id="cb6-6" data-line-number="6">            <span class="dt">meta=</span>covar, </a>
<a class="sourceLine" id="cb6-7" data-line-number="7">            <span class="dt">latentTrajectory =</span> model, </a>
<a class="sourceLine" id="cb6-8" data-line-number="8">            <span class="dt">sig_norm_method=</span><span class="st">"znorm_columns"</span>)</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">vis &lt;-<span class="st"> </span><span class="kw"><a href="../reference/addProjection-Vision-method.html">addProjection</a></span>(vis, <span class="st">"MDS"</span>, model<span class="op">$</span>dimred[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)])</a>
<a class="sourceLine" id="cb6-10" data-line-number="10"></a>
<a class="sourceLine" id="cb6-11" data-line-number="11">vis &lt;-<span class="st"> </span><span class="kw"><a href="../reference/analyze-Vision-method.html">analyze</a></span>(vis)</a></code></pre></div>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session Info</h1>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">sessionInfo</span>()</a></code></pre></div>
<pre><code>## R version 3.5.1 (2018-07-02)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 16.04.4 LTS
## 
## Matrix products: default
## BLAS/LAPACK: /data/yosef2/users/david.detomaso/programs1604/lib/libopenblas_genericp-r0.3.2.so
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] BiocStyle_2.8.2
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.0       knitr_1.20       xml2_1.2.0       magrittr_1.5    
##  [5] roxygen2_6.1.0   MASS_7.3-50      R6_2.2.2         rlang_0.2.1     
##  [9] stringr_1.3.1    tools_3.5.1      xfun_0.3         htmltools_0.3.6 
## [13] commonmark_1.5   yaml_2.2.0       rprojroot_1.3-2  digest_0.6.15   
## [17] assertthat_0.2.0 bookdown_0.7     pkgdown_1.1.0    crayon_1.3.4    
## [21] fs_1.2.6         memoise_1.1.0    evaluate_0.11    rmarkdown_1.10  
## [25] stringi_1.2.4    compiler_3.5.1   desc_1.2.0       backports_1.1.2</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#introduction">Introduction</a><ul class="nav nav-pills nav-stacked">
<li><a href="#installation">Installation</a></li>
      <li><a href="#data">Data</a></li>
      </ul>
</li>
      <li><a href="#workflow">Workflow</a></li>
      <li><a href="#session-info">Session Info</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Matt Jones, Tal Ashuach, David Detomaso.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
